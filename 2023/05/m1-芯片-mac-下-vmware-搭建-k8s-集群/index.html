<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>M1 芯片 Mac 下 Vmware 搭建 k8s 集群 | Petrie's Site</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="环境信息 Mac 硬件信息，执行 system_profiler SPHardwareDataType 查看 1 2 3 4 5 $ system_profiler SPHardwareDataType Hardware: Hardware Overview: Model Identifier: MacBookPro18,3 Chip: Apple M1 Pro Mac OS 信息 执行 ssw_vers 查看 1 2 3 $ sw_vers ProductName: macOS ProductVersion: 13.1 VMware 版本信息 1 2 VMware Fusion Professional Version 13.0.1 (21139760) Centos 版本下载"><meta name=generator content="Hugo 0.110.0"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="M1 芯片 Mac 下 Vmware 搭建 k8s 集群"><meta property="og:description" content="环境信息 Mac 硬件信息，执行 system_profiler SPHardwareDataType 查看 1 2 3 4 5 $ system_profiler SPHardwareDataType Hardware: Hardware Overview: Model Identifier: MacBookPro18,3 Chip: Apple M1 Pro Mac OS 信息 执行 ssw_vers 查看 1 2 3 $ sw_vers ProductName: macOS ProductVersion: 13.1 VMware 版本信息 1 2 VMware Fusion Professional Version 13.0.1 (21139760) Centos 版本下载"><meta property="og:type" content="article"><meta property="og:url" content="https://petrie.github.io/2023/05/m1-%E8%8A%AF%E7%89%87-mac-%E4%B8%8B-vmware-%E6%90%AD%E5%BB%BA-k8s-%E9%9B%86%E7%BE%A4/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-27T18:58:13+08:00"><meta property="article:modified_time" content="2023-05-27T18:58:13+08:00"><meta itemprop=name content="M1 芯片 Mac 下 Vmware 搭建 k8s 集群"><meta itemprop=description content="环境信息 Mac 硬件信息，执行 system_profiler SPHardwareDataType 查看 1 2 3 4 5 $ system_profiler SPHardwareDataType Hardware: Hardware Overview: Model Identifier: MacBookPro18,3 Chip: Apple M1 Pro Mac OS 信息 执行 ssw_vers 查看 1 2 3 $ sw_vers ProductName: macOS ProductVersion: 13.1 VMware 版本信息 1 2 VMware Fusion Professional Version 13.0.1 (21139760) Centos 版本下载"><meta itemprop=datePublished content="2023-05-27T18:58:13+08:00"><meta itemprop=dateModified content="2023-05-27T18:58:13+08:00"><meta itemprop=wordCount content="1626"><meta itemprop=keywords content="k8s,kubeadm,"><meta name=twitter:card content="summary"><meta name=twitter:title content="M1 芯片 Mac 下 Vmware 搭建 k8s 集群"><meta name=twitter:description content="环境信息 Mac 硬件信息，执行 system_profiler SPHardwareDataType 查看 1 2 3 4 5 $ system_profiler SPHardwareDataType Hardware: Hardware Overview: Model Identifier: MacBookPro18,3 Chip: Apple M1 Pro Mac OS 信息 执行 ssw_vers 查看 1 2 3 $ sw_vers ProductName: macOS ProductVersion: 13.1 VMware 版本信息 1 2 VMware Fusion Professional Version 13.0.1 (21139760) Centos 版本下载"><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-SZDN75YQDS"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SZDN75YQDS",{anonymize_ip:!1})}</script></head><script src=https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js></script>
<script>mermaid.initialize({startOnLoad:!0,securityLevel:"loose"})</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4912480012550644" crossorigin=anonymous></script>
<link href=https://petrie.github.io/css/main.css rel=stylesheet type=text/css><link href=https://petrie.github.io/css/style.css rel=stylesheet type=text/css></head><body class="ma0 avenir bg-near-white"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">Petrie's Site</a><div class="flex-l items-center"><ul class="pl0 mr3"><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/posts/ title="文章 页">文章</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/categories/ title="分类 页">分类</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/tags/ title="标签 页">标签</a></li><li class="list f5 f4-ns fw4 dib pr3"><a class="hover-white no-underline white-90" href=/about/ title="关于我 页">关于我</a></li></ul><div class=ananke-socials><a href=https://github.com/petrie target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">文章</aside><div id=sharing class="mt3 ananke-socials"></div><h1 class="f1 athelas mt3 mb1">M1 芯片 Mac 下 Vmware 搭建 k8s 集群</h1><time class="f6 mv4 dib tracked" datetime=2023-05-27T18:58:13+08:00>2023年05月27日</time>
<span class="f6 mv4 dib tracked">&nbsp;&nbsp;&nbsp;&nbsp; 1626 字</span>
<span class="f6 mv4 dib tracked">- 4 分钟</span></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-100-l"><nav id=TableOfContents><ul><li><a href=#环境信息>环境信息</a></li><li><a href=#准备虚拟机>准备虚拟机</a><ul><li><a href=#设置-mac-hosts>设置 Mac hosts</a></li><li><a href=#设置免密登录>设置免密登录</a></li><li><a href=#设置两台虚拟机器-hostname>设置两台虚拟机器 hostname</a></li></ul></li><li><a href=#安装容器运行时间>安装容器运行时间</a><ul><li><a href=#总览>总览</a></li><li><a href=#容器运行时安装和配置的先决条件>容器运行时安装和配置的先决条件</a></li><li><a href=#安装容器运行时-containerd>安装容器运行时 containerd</a></li></ul></li><li><a href=#安装-kubeadmkubelet-和-kubectl>安装 kubeadm、kubelet 和 kubectl</a><ul><li><a href=#添加yum源>添加yum源</a></li><li><a href=#yum-安装kubelet-kubeadm-kubectl>yum 安装kubelet kubeadm kubectl</a></li><li><a href=#设置-kubelet-开机自启动>设置 kubelet 开机自启动</a></li></ul></li><li><a href=#使用-kubeadm-创建集群>使用 kubeadm 创建集群</a><ul><li><a href=#生成默认配置>生成默认配置</a></li><li><a href=#替换镜像地址>替换镜像地址</a></li><li><a href=#创建集群>创建集群</a></li><li><a href=#查看集群状态>查看集群状态</a></li></ul></li></ul></nav><h2 id=环境信息>环境信息</h2><p>Mac 硬件信息，执行 <code>system_profiler SPHardwareDataType</code> 查看</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-4>4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-0-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-0-5>5</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ system_profiler SPHardwareDataType
</span></span><span style=display:flex><span>Hardware:
</span></span><span style=display:flex><span>    Hardware Overview:
</span></span><span style=display:flex><span>      Model Identifier: MacBookPro18,3
</span></span><span style=display:flex><span>      Chip: Apple M1 Pro
</span></span></code></pre></td></tr></table></div></div><p>Mac OS 信息
执行 <code>ssw_vers</code> 查看</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-1-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-1-3>3</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sw_vers
</span></span><span style=display:flex><span>ProductName:		macOS
</span></span><span style=display:flex><span>ProductVersion:		13.1
</span></span></code></pre></td></tr></table></div></div><p>VMware 版本信息</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-2-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-2-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>VMware Fusion
</span></span><span style=display:flex><span>Professional Version 13.0.1 (21139760)
</span></span></code></pre></td></tr></table></div></div><p>Centos 版本<a href="https://mirrors.centos.org/mirrorlist?path=/9-stream/BaseOS/aarch64/iso/CentOS-Stream-9-latest-aarch64-dvd1.iso&redirect=1&protocol=https">下载地址</a></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-3-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-3-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>CentOS-Stream-9-latest-aarch64-dvd1.iso
</span></span></code></pre></td></tr></table></div></div><h2 id=准备虚拟机>准备虚拟机</h2><p>注意虚拟机的网络配置需要选择<code>Autodetect</code>模式，以便虚拟机和物理机器共享网络
两台机器：</p><ul><li>k8s-master 192.168.1.98</li><li>k8s-node1 192.168.1.97</li></ul><h3 id=设置-mac-hosts>设置 Mac hosts</h3><p>在 Mac 执行以下命令</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-4-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-4-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#0086b3>echo</span> <span style=color:#d14>&#39;192.168.1.98 k8s-master\n192.168.1.97 k8s-node1 &#39;</span> | sudo tee -a /etc/hosts
</span></span></code></pre></td></tr></table></div></div><h3 id=设置免密登录>设置免密登录</h3><p>在 Mac 执行以下命令</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-5-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-5-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-copy-id -i ~/.ssh/id_rsa.pub root@k8s-master
</span></span><span style=display:flex><span>ssh-copy-id -i ~/.ssh/id_rsa.pub root@k8s-node1
</span></span></code></pre></td></tr></table></div></div><h3 id=设置两台虚拟机器-hostname>设置两台虚拟机器 hostname</h3><p>在 Mac 执行以下命令</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-6-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-6-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh <span style=color:#d14>&#39;root@k8s-master&#39;</span> <span style=color:#d14>&#34;hostnamectl set-hostname k8s-master&#34;</span>
</span></span><span style=display:flex><span>ssh <span style=color:#d14>&#39;root@k8s-node1&#39;</span> <span style=color:#d14>&#34;hostnamectl set-hostname k8s-node1&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=安装容器运行时间>安装容器运行时间</h2><p>后续将使用 kubeadm 工具，进行k8s的部署。主要参考文档：<a href=https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/>使用 kubeadm 引导集群</a>
以下步骤，将在官方文档的基础上进行改进。改进目标是适配国内的网络。
如：</p><ul><li>替换yum安装源为阿里源</li><li>替换容器镜像源为阿里镜像源</li></ul><h3 id=总览>总览</h3><p>主要有以下几个步骤</p><ul><li>容器运行时安装和配置的先决条件，如禁用swap交换分区、关闭防火墙、配置网络转发等</li><li>安装容器运行时 containerd</li></ul><h3 id=容器运行时安装和配置的先决条件>容器运行时安装和配置的先决条件</h3><h4 id=1禁用swap交换分区>1、禁用swap交换分区</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-7-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-7-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo swapoff -a <span style=color:#998;font-style:italic>#临时禁用</span>
</span></span><span style=display:flex><span>sed -i <span style=color:#d14>&#39;s/.*swap.*/#&amp;/g&#39;</span> /etc/fstab <span style=color:#998;font-style:italic>#更新配置文件，永久禁用</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=2转发ipv4>2、转发IPv4</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-10>10</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-11>11</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-12>12</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-13><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-13>13</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-14><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-14>14</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-15><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-15>15</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-16><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-16>16</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-8-17><a style=outline:none;text-decoration:none;color:inherit href=#hl-8-17>17</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cat <span style=color:#d14>&lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf
</span></span></span><span style=display:flex><span><span style=color:#d14>overlay
</span></span></span><span style=display:flex><span><span style=color:#d14>br_netfilter
</span></span></span><span style=display:flex><span><span style=color:#d14>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sudo modprobe overlay
</span></span><span style=display:flex><span>sudo modprobe br_netfilter
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># 设置所需的 sysctl 参数，参数在重新启动后保持不变</span>
</span></span><span style=display:flex><span>cat <span style=color:#d14>&lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
</span></span></span><span style=display:flex><span><span style=color:#d14>net.bridge.bridge-nf-call-iptables  = 1
</span></span></span><span style=display:flex><span><span style=color:#d14>net.bridge.bridge-nf-call-ip6tables = 1
</span></span></span><span style=display:flex><span><span style=color:#d14>net.ipv4.ip_forward                 = 1
</span></span></span><span style=display:flex><span><span style=color:#d14>EOF</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#998;font-style:italic># 应用 sysctl 参数而不重新启动</span>
</span></span><span style=display:flex><span>sudo sysctl --system
</span></span></code></pre></td></tr></table></div></div><h4 id=3关闭selinux>3、关闭selinux</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-9-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-9-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>setenforce <span style=color:#099>0</span>
</span></span><span style=display:flex><span>sed -ri <span style=color:#d14>&#39;s/SELINUX=enforcing/SELINUX=disabled/&#39;</span> /etc/selinux/config
</span></span></code></pre></td></tr></table></div></div><h4 id=4关闭防火墙>4、关闭防火墙</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-10-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-10-3>3</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>systemctl disable firewalld <span style=color:#998;font-style:italic>#永久禁用防火墙</span>
</span></span><span style=display:flex><span>systemctl stop firewalld  <span style=color:#998;font-style:italic>#关闭防火墙</span>
</span></span><span style=display:flex><span>firewall-cmd --state <span style=color:#998;font-style:italic>#查看状态，返回应为 not running</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=安装容器运行时-containerd>安装容器运行时 containerd</h3><p><a href=https://kubernetes.io/zh-cn/docs/setup/production-environment/container-runtimes/#containerd>参考文档</a></p><h4 id=1下载后分别拷贝到两台虚拟机中>1、下载后分别拷贝到两台虚拟机中</h4><p>使用官方二进制的形式安装。在<a href=https://github.com/containerd/containerd/releases>release</a>中下载<code>containerd-1.7.1-linux-arm64.tar.gz</code>。</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-11-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-11-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>scp ~/Downloads/containerd-1.7.1-linux-arm64.tar.gz root@k8s-master:~
</span></span><span style=display:flex><span>scp ~/Downloads/containerd-1.7.1-linux-arm64.tar.gz root@k8s-node1:~
</span></span></code></pre></td></tr></table></div></div><h4 id=2解压安装containerd>2、解压安装containerd</h4><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-12-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-12-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-12-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ssh <span style=color:#d14>&#39;root@k8s-master&#39;</span> <span style=color:#d14>&#34;tar Cxzvf /usr/local ~/containerd-1.7.1-linux-arm64.tar.gz&#34;</span>
</span></span><span style=display:flex><span>ssh <span style=color:#d14>&#39;root@k8s-node1&#39;</span> <span style=color:#d14>&#34;tar Cxzvf /usr/local ~/containerd-1.7.1-linux-arm64.tar.gz&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=3设置containerd开启启动>3、设置containerd开启启动</h4><p>创建文件<code>containerd.service</code>配置文件</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-13-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-13-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-13-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#0086b3>cd</span> /tmp; 
</span></span><span style=display:flex><span>wget https://ghproxy.com/https://raw.githubusercontent.com/containerd/containerd/main/containerd.service 
</span></span></code></pre></td></tr></table></div></div><p>这里使用了加速网站，有条件的同学可以直接访问。</p><p>这时containerd.service 文件会被下载到/tmp/containerd.service。
使用以下命令将此文件同步到两台虚拟机。
首先创建目录</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-14-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-14-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-14-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ssh <span style=color:#d14>&#39;root@k8s-master&#39;</span> <span style=color:#d14>&#34;mkdir -p /usr/local/lib/systemd/system/&#34;</span>
</span></span><span style=display:flex><span>ssh <span style=color:#d14>&#39;root@k8s-node1&#39;</span> <span style=color:#d14>&#34;mkdir -p /usr/local/lib/systemd/system/&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>同步文件</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-15-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-15-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-15-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-15-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>scp /tmp/containerd.service root@k8s-master:/usr/local/lib/systemd/system/
</span></span><span style=display:flex><span>scp /tmp/containerd.service root@k8s-node1:/usr/local/lib/systemd/system/
</span></span></code></pre></td></tr></table></div></div><p>启动containerd服务，并设置开机自启动</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-16-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-16-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ssh <span style=color:#d14>&#39;root@k8s-master&#39;</span> <span style=color:#d14>&#34;systemctl daemon-reload &amp;&amp; systemctl enable --now containerd&#34;</span>
</span></span><span style=display:flex><span>ssh <span style=color:#d14>&#39;root@k8s-node1&#39;</span> <span style=color:#d14>&#34;systemctl daemon-reload &amp;&amp; systemctl enable --now containerd&#34;</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=4安装runc>4、安装runc</h4><p>在<a href=https://github.com/opencontainers/runc/releases>release</a>中下载对应二进制文件，这里下载<code>runc.arm64</code>。
在 Mac 上执行以下命令，将其同步至两台虚拟机。</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-17-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-17-2>2</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>scp ~/Downloads/runc.arm64 root@k8s-master:~
</span></span><span style=display:flex><span>scp ~/Downloads/runc.arm64 root@k8s-node1:~
</span></span></code></pre></td></tr></table></div></div><p>在 Mac 上执行以下命令，安装runc</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-18-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-18-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-18-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-18-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-18-4>4</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#000;font-weight:700>for</span> i in master node1;
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>do</span>
</span></span><span style=display:flex><span>ssh <span style=color:#d14>&#34;root@k8s-</span><span style=color:teal>$i</span><span style=color:#d14>&#34;</span> <span style=color:#d14>&#34;install -m 755 ~/runc.arm64 /usr/local/sbin/runc&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>done</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=5设置-containerd-配置文件>5、设置 containerd 配置文件</h4><p>在 Mac 下执行，设置containerd默认配置文件</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-19-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-19-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-19-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-19-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-19-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-19-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-19-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-19-4>4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-19-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-19-5>5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-19-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-19-6>6</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#000;font-weight:700>for</span> i in master node1;
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>do</span>
</span></span><span style=display:flex><span>ssh <span style=color:#d14>&#34;root@k8s-</span><span style=color:teal>$i</span><span style=color:#d14>&#34;</span>  <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span><span style=color:#d14>&#34;mkdir /etc/containerd &amp;&amp; \
</span></span></span><span style=display:flex><span><span style=color:#d14>containerd config default &gt; /etc/containerd/config.toml&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>done</span>
</span></span></code></pre></td></tr></table></div></div><p>生成配置文件后，需要将 /etc/containerd/config.toml 文件中的 SystemdCgroup 设置为 true
或者直接在 MAC 下执行以下命令：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-20-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-20-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-20-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-20-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-20-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-20-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-20-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-20-4>4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-20-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-20-5>5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-20-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-20-6>6</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#000;font-weight:700>for</span> i in master node1;
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>do</span>
</span></span><span style=display:flex><span>ssh <span style=color:#d14>&#34;root@k8s-</span><span style=color:teal>$i</span><span style=color:#d14>&#34;</span>  <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span><span style=color:#d14>&#34;sed -ri &#39;s/SystemdCgroup = false/SystemdCgroup = true/&#39; \
</span></span></span><span style=display:flex><span><span style=color:#d14>/etc/containerd/config.toml&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>done</span>
</span></span></code></pre></td></tr></table></div></div><h4 id=6沙箱镜像替换>6.沙箱镜像替换</h4><p>在 Mac 下，执行以下命令：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-21-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-21-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-21-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-21-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-21-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-21-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-21-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-21-4>4</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#000;font-weight:700>for</span> i in master node1;
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>do</span>
</span></span><span style=display:flex><span>ssh <span style=color:#d14>&#34;root@k8s-</span><span style=color:teal>$i</span><span style=color:#d14>&#34;</span> <span style=color:#d14>&#34;sed -ri &#39;s#sandbox_image = \&#34;registry.k8s.io/pause:3.8\&#34;#sandbox_image = \&#34;registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.8\&#34;#&#39; /etc/containerd/config.toml&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>done</span>
</span></span></code></pre></td></tr></table></div></div><p>到这里 containred 服务就配置完成了。
最后需要在重启containerd服务
执行以下命令：</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-4>4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-22-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-22-5>5</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#000;font-weight:700>for</span> i in master node1;
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>do</span>
</span></span><span style=display:flex><span>ssh <span style=color:#d14>&#34;root@k8s-</span><span style=color:teal>$i</span><span style=color:#d14>&#34;</span>  <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span><span style=color:#d14>&#34;systemctl restart containerd&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>done</span>
</span></span></code></pre></td></tr></table></div></div><p>可以登录到虚拟机，使用<code>systemctl status containerd.service</code>查看服务状态。</p><h2 id=安装-kubeadmkubelet-和-kubectl>安装 kubeadm、kubelet 和 kubectl</h2><p><a href=https://kubernetes.io/zh-cn/docs/setup/production-environment/tools/kubeadm/install-kubeadm/#installing-kubeadm-kubelet-and-kubectl>参考文档</a></p><h3 id=添加yum源>添加yum源</h3><p>参考以上官方文档，添加相关yum源，这里需要把google的yum源替换为阿里云的。</p><p>在 Mac 执行以下命令</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-1> 1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-2> 2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-3> 3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-4> 4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-5> 5</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-6><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-6> 6</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-7><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-7> 7</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-8><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-8> 8</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-9><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-9> 9</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-10><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-10>10</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-11><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-11>11</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-23-12><a style=outline:none;text-decoration:none;color:inherit href=#hl-23-12>12</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000;font-weight:700>for</span> i in master node1;
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>do</span>
</span></span><span style=display:flex><span>ssh <span style=color:#d14>&#34;root@k8s-</span><span style=color:teal>$i</span><span style=color:#d14>&#34;</span>  <span style=color:#d14>&#34;cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo
</span></span></span><span style=display:flex><span><span style=color:#d14>[kubernetes]
</span></span></span><span style=display:flex><span><span style=color:#d14>name=Kubernetes
</span></span></span><span style=display:flex><span><span style=color:#d14>baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-aarch64/
</span></span></span><span style=display:flex><span><span style=color:#d14>enabled=1
</span></span></span><span style=display:flex><span><span style=color:#d14>gpgcheck=1
</span></span></span><span style=display:flex><span><span style=color:#d14>repo_gpgcheck=1
</span></span></span><span style=display:flex><span><span style=color:#d14>gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
</span></span></span><span style=display:flex><span><span style=color:#d14>EOF&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>done</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=yum-安装kubelet-kubeadm-kubectl>yum 安装kubelet kubeadm kubectl</h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-4>4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-24-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-24-5>5</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000;font-weight:700>for</span> i in master node1;
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>do</span>
</span></span><span style=display:flex><span>ssh <span style=color:#d14>&#34;root@k8s-</span><span style=color:teal>$i</span><span style=color:#d14>&#34;</span> <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span><span style=color:#d14>&#34;sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>done</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=设置-kubelet-开机自启动>设置 kubelet 开机自启动</h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-3>3</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-4><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-4>4</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-25-5><a style=outline:none;text-decoration:none;color:inherit href=#hl-25-5>5</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#000;font-weight:700>for</span> i in master node1;
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>do</span>
</span></span><span style=display:flex><span>ssh <span style=color:#d14>&#34;root@k8s-</span><span style=color:teal>$i</span><span style=color:#d14>&#34;</span> <span style=color:#d14>\
</span></span></span><span style=display:flex><span><span style=color:#d14></span>sudo systemctl <span style=color:#0086b3>enable</span> --now kubelet
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>done</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=使用-kubeadm-创建集群>使用 kubeadm 创建集群</h2><h3 id=生成默认配置>生成默认配置</h3><p>登录k8s-master节点
执行以下命令将默认配置倒入到 <code>admin.conf</code></p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-26-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-26-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubeadm config print  init-defaults &gt; admin.conf
</span></span></code></pre></td></tr></table></div></div><h3 id=替换镜像地址>替换镜像地址</h3><p>执行以下命令替换替换容器镜像地址</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-27-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-27-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sed -ri <span style=color:#d14>&#39;s/imageRepository: registry.k8s.io/imageRepository: registry.cn-hangzhou.aliyuncs.com\/google_containers/g&#39;</span> admin.conf
</span></span></code></pre></td></tr></table></div></div><p>执行以下命令替换API Server启动ip</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-28-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-28-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sed -ri <span style=color:#d14>&#39;s/advertiseAddress: 1.2.3.4/advertiseAddress: 192.168.1.98/g&#39;</span> admin.conf
</span></span></code></pre></td></tr></table></div></div><h3 id=创建集群>创建集群</h3><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-29-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-29-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubeadm init --config<span style=color:#000;font-weight:700>=</span>admin.conf
</span></span></code></pre></td></tr></table></div></div><h3 id=查看集群状态>查看集群状态</h3><p>执行以下命令</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-30-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-30-1>1</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl version
</span></span></code></pre></td></tr></table></div></div><p>返回以下结果，代表成功</p><div class=highlight><div style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-1><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-1>1</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-2><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-2>2</a>
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f" id=hl-31-3><a style=outline:none;text-decoration:none;color:inherit href=#hl-31-3>3</a>
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Client Version: version.Info{Major:&#34;1&#34;, Minor:&#34;27&#34;, GitVersion:&#34;v1.27.2&#34;, GitCommit:&#34;7f6f68fdabc4df88cfea2dcf9a19b2b830f1e647&#34;, GitTreeState:&#34;clean&#34;, BuildDate:&#34;2023-05-17T14:20:07Z&#34;, GoVersion:&#34;go1.20.4&#34;, Compiler:&#34;gc&#34;, Platform:&#34;linux/arm64&#34;}
</span></span><span style=display:flex><span>Kustomize Version: v5.0.1
</span></span><span style=display:flex><span>Server Version: version.Info{Major:&#34;1&#34;, Minor:&#34;27&#34;, GitVersion:&#34;v1.27.0&#34;, GitCommit:&#34;1b4df30b3cdfeaba6024e81e559a6cd09a089d65&#34;, GitTreeState:&#34;clean&#34;, BuildDate:&#34;2023-04-11T17:04:24Z&#34;, GoVersion:&#34;go1.20.3&#34;, Compiler:&#34;gc&#34;, Platform:&#34;linux/arm64&#34;}
</span></span></code></pre></td></tr></table></div></div><ul class=pa0>标签：<li class="list di"><a href=/tags/k8s class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">k8s</a></li><li class="list di"><a href=/tags/kubeadm class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">kubeadm</a></li></ul><ul class=pa0>分类：<li class="list di"><a href=/categories/k8s class="link f5 grow no-underline br-pill ba ph3 pv2 mb2 dib black sans-serif">k8s</a></li></ul><div class="mt6 instapaper_ignoref"><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//petrie.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://petrie.github.io/>&copy; Petrie's Site 2023</a><div><div class=ananke-socials><a href=https://github.com/petrie target=_blank class="github ananke-social-link link-transition stackoverflow link dib z-999 pt3 pt0-l mr1" title="GitHub link" rel=noopener aria-label="follow on GitHub——Opens in a new window"><span class=icon><svg style="enable-background:new 0 0 512 512" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M256 32C132.3 32 32 134.8 32 261.7c0 101.5 64.2 187.5 153.2 217.9 11.2 2.1 15.3-5 15.3-11.1.0-5.5-.2-19.9-.3-39.1-62.3 13.9-75.5-30.8-75.5-30.8-10.2-26.5-24.9-33.6-24.9-33.6-20.3-14.3 1.5-14 1.5-14 22.5 1.6 34.3 23.7 34.3 23.7 20 35.1 52.4 25 65.2 19.1 2-14.8 7.8-25 14.2-30.7-49.7-5.8-102-25.5-102-113.5.0-25.1 8.7-45.6 23-61.6-2.3-5.8-10-29.2 2.2-60.8.0.0 18.8-6.2 61.6 23.5 17.9-5.1 37-7.6 56.1-7.7 19 .1 38.2 2.6 56.1 7.7 42.8-29.7 61.5-23.5 61.5-23.5 12.2 31.6 4.5 55 2.2 60.8 14.3 16.1 23 36.6 23 61.6.0 88.2-52.4 107.6-102.3 113.3 8 7.1 15.2 21.1 15.2 42.5.0 30.7-.3 55.5-.3 63 0 6.1 4 13.3 15.4 11C415.9 449.1 480 363.1 480 261.7 480 134.8 379.7 32 256 32z"/></svg></span><span class=new-window><svg height="8" style="enable-background:new 0 0 1000 1000" viewBox="0 0 1e3 1e3" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M598 128h298v298h-86V274L392 692l-60-60 418-418H598v-86zM810 810V512h86v298c0 46-40 86-86 86H214c-48 0-86-40-86-86V214c0-46 38-86 86-86h298v86H214v596h596z" style="fill-rule:evenodd;clip-rule:evenodd"/></svg></span></a></div></div></div></footer></body></html>